{"meta":{"title":"Mr.zhang","subtitle":"","description":"","author":"John Doe","url":"http://example.com","root":"/"},"pages":[{"title":"标签","date":"2021-07-22T04:39:04.000Z","updated":"2021-07-16T06:38:28.037Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":"dsdsdsd"},{"title":"分类","date":"2021-07-10T04:39:04.000Z","updated":"2021-07-16T05:52:07.570Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"Samba加ad域管理","slug":"Samba加AD域管理","date":"2021-08-31T07:37:52.600Z","updated":"2021-08-31T09:01:07.129Z","comments":true,"path":"2021/08/31/Samba加AD域管理/","link":"","permalink":"http://example.com/2021/08/31/Samba%E5%8A%A0AD%E5%9F%9F%E7%AE%A1%E7%90%86/","excerpt":"","text":"安装软件包 1yum -y install pam_krb5* krb5-libs* krb5-workstation* krb5-devel* krb5-auth samba samba-winbind* samba-client* samba-swat* bind-utils 把服务都先启动 1systemctl start winbind smb nmb 配置 改host名称 1hostnamectl set-hostname idcfileserver 添加域DNS 123vim /etc/sysconfig/network-scripts/ifcfg-eth0```DNS2=10.10.4.2 配置krb5 1234567891011121314151617181920212223242526272829303132333435363738394041[root@smbszsandstone ~]# cat /etc/krb5.conf# Configuration snippets may be placed in this directory as wellincludedir /etc/krb5.conf.d/#includedir /var/lib/sss/pubconf/krb5.include.d/[logging] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log[libdefaults] dns_lookup_realm = true dns_lookuo_kdc = true ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false pkinit_anchors = /etc/pki/tls/certs/ca-bundle.crt# default_realm = EXAMPLE.COM default_ccache_name = KEYRING:persistent:%&#123;uid&#125; default_realm = XXX.COM[realms]# EXAMPLE.COM = &#123;# kdc = kerberos.example.com# admin_server = kerberos.example.com# &#125; SZSANDSTONE.COM = &#123; admin_server = dc.xxx.com &#125; SZSANDSTONE.COM = &#123; kdc = dc.xxx.com &#125;[domain_realm]# .example.com = EXAMPLE.COM# example.com = EXAMPLE.COMszsandstone.com = XXX.COM.szsandstone.com = XXX.COM 配置NSS 12345# vim /etc/nsswitch.conf------------------------------------------------------------passwd: files winbindgroup: files winbind------------------------------------------------------------ 加域 1234567891011#检查一下域是否正常[root@pubfileserver mnt]# wninfo -t[root@pubfileserver mnt]# wninfo -g#加域[root@pubfileserver mnt]# net ads join -U administratorEnter administrator&#x27;s password:Using short domain name -- XXXJoined &#x27;IDCFILESERVER&#x27; to dns domain &#x27;XXX.com&#x27;No DNS domain configured for idcfileserver. Unable to perform DNS Update.DNS update failed: NT_STATUS_INVALID_PARAMETER Samba配置 1234567891011121314151617181920212223[root@pubfileserver mnt]# cat /etc/samba/smb.conf[global] workgroup = XXX password server = dc.XXX.com realm = XXX.COM security = ads passdb backend = tdbsam idmap config * : range = 16777216-33554431 template shell = /bin/bash kerberos method = secrets only winbind use default domain = true winbind enum users = yes winbind enum groups = yes bind interfaces only = yes winbind offline logon = false[homes] comment = 个人目录 root preexec = /etc/samba/mkUserHome.sh %S path = /mnt/02.home/%S valid users = XXX\\%S browseable = NO read only = No writeable = Yes 自动创建用户目录脚本 123456789[root@pubfileserver mnt]# cat /etc/samba/mkUserHome.sh#!/bin/bashumask 077user=$1if [ ! -d /mnt/02.home/$user ];thenmkdir /mnt/02.home/$userchmod 777 /mnt/02.home/$userchown $user:&quot;domain users&quot; /mnt/02.home/$userfi 重启服务 1systemctl restart smb nmb winbind","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"}]},{"title":"exsi速用命令和常见问题","slug":"exsi速用命令和常见问题","date":"2021-07-30T08:05:03.624Z","updated":"2021-07-30T08:06:36.535Z","comments":true,"path":"2021/07/30/exsi速用命令和常见问题/","link":"","permalink":"http://example.com/2021/07/30/exsi%E9%80%9F%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/","excerpt":"","text":"修改root password vicfg-user –url https://esxi-host/sdk/webService –username root –password [old-pwd] -u root -e user -l root -o modify -p [new-pwd] esxcli hardware – 想获取ESXi主机的硬件及配置信息时，esxcli硬件命名空间就能够派上用场了。 esxcli hardware cpu list – 获取CPU信息（系列、型号以及缓存） esxcli hardware memory get – 获取内存信息（可用内存以及非一致内存访问） esxcli iscsi – iscsi命名空间可以被用于监控并管理硬件iSCSI及软件iSCSI设置。 esxcli iscsi software –用于启用/禁用软件iSCSI initiator。 esxcli iscsi adapter –用于设置软硬件iSCSI适配器的发现、CHAP以及其他设置 esxcli iscsi sessions – 用于列出主机上已建立的iSCSI会话。 esxcli network –需要监控vSphere网络并对如下网络组件进行调整时，包括虚拟交换机、VMkernel网络接口、防火墙以及物理网卡等，esxcli网络命名空间就派上用场了。 esxcli network nic –列出并修改网卡信息，比如名字、唤醒网卡以及速度。 esxcli network vm list – 列出有一个活动网络端口的虚拟机的网络信息。 esxcli network vswitch –检索并管理VMware的标准交换机以及分布式虚拟交换机。 esxcli network ip – 管理VMkernel端口，包括管理、vMotion以及FT网络。还可以修改主机的所有IP栈，包括DNS、IPsec以及路由信息。 esxcli software – 软件命名空间可以用于检索ESXi主机已安装的软件及驱动并可以安装新组件。 esxcli software vib list – 列出ESXi主机上已经安装的软件及驱动。 esxcli storage – 可能是最常用的esxcli命令命名空间之一，包括了管理连接到vSphere的存储的所有信息。 esxcli storage core device list – 列出当前存储设备 esxcli storage core device vaai status get –获得存储设备支持的VAAI的当前状态。 esxcli system – 通过该命令使你能够控制ESXi的高级选项，比如设置syslog并管理主机状态。 esxcli system maintenanceMode set –enabled yes/no – 将主机设置为维护模式 查看并更改ESXi高级设置（提示：使用esxcli system settings advanced list –d 命令查看非默认设置） esxcli system syslog –查看 Syslog 及配置信息 esxcli vm – ESXi的虚拟机命名空间用于列出运行在主机上的虚拟机的各种信息，如果需要可以强制关闭这些虚拟机。 esxcli vm process list –列出已启动的虚拟机的进程信息。 esxcli vm process kill – 停止正在运行的虚拟机的进程，关闭虚拟机或者强制关闭虚拟机电源。 esxcli vsan – ESXi的VSAN命名空间包括配置并维护VSAN的很多命令，包括数据存储、网络、默认域名以及策略配置。 esxcli vsan storage – 配置VSAN使用的本地存储，包括增加、删除物理存储并修改自动声明。 esxcli vsan cluster – 本地主机脱离/加入VSAN集群。 esxcli esxcli – esxcli命令包括一个称为esxcli的命名空间，通过使用esxcli命名空间，你可以获得更多信息。 esxcli esxcli command list – 列出所有的esxcli命令及其提供的功能。 当然，上述命令及示例并未涵盖ESXi提供的所有功能。所有的ESXi命令有多个开关及选项，提供了多种功能。通过输入-h参数可以获得相关帮助信息。 通过命令行进行故障诊断是一件很棘手的事儿，但通过对25个ESXi命令有一个深入的理解，你应该能够顺利解决大多数问题。 1****、启用客户机操作系统和远程控制台之间的复制和粘贴操作 解决方法：要在客户机操作系统和远程控制台之间进行复制和粘贴，必须使用 vSphere Client 启用复制和粘贴操作。 步骤 a、使用 vSphere Client 登录到 vCenter Server 系统并选择虚拟机。 b、在摘要选项卡中，单击编辑设置。 c、选择选项 &gt; 高级 &gt; 常规，然后单击配置参数。 d、单击添加行，并在“名称”和“值”列中键入以下值。 名称值 isolation.tools.copy.disable false isolation.tools.paste.disable false 注意这些选项将替代在客户机操作系统的 VMware Tools 控制面板中做出的任何设置。 e、单击确定以关闭“配置参数”对话框，然后再次单击确定以关闭“虚拟机属性”对话框。 f、重新启动虚拟机。 2、sco****系统迁移过去之后找不到启动列表 解决方法：目前解决方法：使用软驱制作应急盘，通过应急盘来找到启动列表，如果不行的话，只能使用，现成的虚拟镜像导入vmware中，但是这种方法，要自己设置与自己相关的应用。 3、linux做迁移时手动添加的逻辑分区（LVM****卷），迁移过去之后找不到这些分区 解决方法：：给虚拟机额外添加硬盘后融合，然后将数据重新拷入加入的硬盘中。 4、安装esxi****的时候找不到万兆网卡 解决方法：解决方法：安装各个厂商OEM的esxi版本。 5、迁移时提示vss****原卷不能克隆 解决方法：解决方法：查看是否有额外的设备插在服务器上，如usb设备。 6、Windows迁移之后，配置网卡的时候，会提示“IP****已经被分配给其他的适配器” 解决方法：打开命令行窗口（运行cmd），输入：（1）、set DEVMGR_SHOW_NONPRESENT_DEVICES=1 （2）、devmgmt.msc 在弹出的“设备管理器”窗口。选择“查看（V）”—“显示隐藏的设备（W）”，然后展开“网络适配器”子项，可以看到一些透明图标显示的网卡信息，这些信息是源服务器的物理网卡信息。然后选择透明的设备卸载，RAS同步适配器为系统正常设备，不需要将其卸载。 7、Asianux3.0****迁移之后不能显示图形化界面 解决方法：解决方法：cp /etc/X11/xorg.conf /etc/X11/xorg.conf.bak vi /etc/X11/xorg.conf 将xorg.conf文件中的selection “Devices”字段中Driver对应的值修改为“vmware”即可，修改完成后通过startx启动图形化界面。 8****、迁移域控主机后发生当虚拟机开启后，物理机就断网 解决方法：单播和多播的问题 9、在VC****中虚拟机的鼠标全屏之后，不能控制整个屏幕 解决方法：当时安装的是esxi 4.1，将esxi4.1升级到esxi4.1upd01 ，同时要将VC client也升级到对应的版本。 10、迁移过去的win2003****的系统，隔段时间之后会蓝屏或重启 解决方法：查看系统日志，有可能是杀毒软件的原因，将杀毒软件卸载重装。 11、使用FT****功能需同时具备以下条件 解决方法：1 所有ESX必须为4.0以上，Build版本相同，以及在同一个HA Cluster中 2 服务器的CPU要求是同一系列(并且要求是AMD Barcelona+, Intel Penryn+的CPU) 3 BIOS中要启用VT及禁用Hyperthreading（超线程）,最好同时禁用电源管理 4 每个VM只能分配1颗vCPU 5 要有专门的千兆网络负责FT 6 VM要放在共享存储上 7 VM的配置文件必须为版本7 8 Guest OS不要启用Paravirtualized 9 启用FT的VM不支持自动DRS 10 启用FT的VM不支持Snapshot 11 启用FT的VM不支持 MS Cluster 12 启用FT的VM不支持物理RDM Mapping 13 启用FT的VM的虚拟CD-ROM最好断开 14 启用FT的VM不支持NPIV (N-Port ID Virtualization) 15 启用FT的VM不支持Device HotAdd/HotPlug 大型虚拟机可能会阻止使用容错 如果虚拟机太大（大于 15GB）或内存的变化速率大于 VMotion 通过网络进行复制的速率， 则启用容错或使用VMotion 迁移正在运行的容错虚拟机时可能会失败。 12、如何确认克隆后的系统SID是否更新****解决方法：Windows2003/2008 、windows 7可使用本地账户登录系统，输入“whoami /user”查看Windows xp没有whoami命令，可通过注册表查看 13、vSphere****所需要开放的端口 解决方法：80 vCenter Server需要端口80用于直接HTTP连接。端口80会将请求重定向到HTTPS端口 443。如果意外使用了http://server而不是https://server，此端口将非常有用。 389 此端口在vCenter Server的本地和所有远程实例上必须处于打开状态。这是vCenter Server组的目录服务的LDAP端口号。vCenter Server系统需要绑定端口389，即使没有将此 vCenter Server实例加入到 链接模式组。如果此端口上正在运行另一服务，则最好移除该服务，或将其端口更改为其他端口。可以在从1025到65535的任一端口上运行LDAP服务。如果此实例充当Microsoft Windows活动目录，请将端口号从389 、更改为从 1025 到 65535 的任一可用端口。 443 vCenter Server系统用于侦听来自vSphere Client的连接的默认端口。要使vCenter Server从vSphere Client接收数据，请在防火墙中打开443端口。vCenter Server系统还使用端口443侦听从vSphere Web Access Client和其他SDK客户端传输的数据。如果对HTTPS使用另一个端口号，则登录vCenter Server系统时必须使用:。 636 对于vCenter链接模式，这是本地实例的 SSL端口。如果此端口上正在运行另一服务，则最好移除该服务，或将其端口更改为其他端口。可以在从1025到65535的任一端口上运行 SSL服务。 902 vCenter Server系统用于将数据发送到受管主机的默认端口。受管主机也会通过UDP端口902定期向vCenter Server系统发送检测信号。服务器和主机之间或各个主机之间的防火墙不得阻止此端口。 902/903 不得在vSphere Client和主机之间阻塞端口902和903。这些端口由vSphere Client 使用以显示虚拟机控制台。 8080 Web服务HTTP。用于VMware VirtualCenter Management Webservices。 8443 Web服务HTTPS。用于VMware VirtualCenter Management Webservices。 60099 Web服务更改服务通知端口 如果希望vCenter Serve 系统使用不同的端口接收vSphere Client数据，请参见《VMware vSphere 数据中心管理指南 14****、虚拟机文件有哪些 解决方法： .vmx vmname.vmx 虚拟机配置文件 .vmxf vmname.vmxf 其他虚拟机配置文件 .vmdk vmname.vmdk 虚拟磁盘特性 -flat.vmdk vmname-flat.vmdk 预分配虚拟磁盘 .nvram vmname.nvram 或 nvram 虚拟机 BIOS .vmsd vmname.vmsd 虚拟机快照 .vmsn vmname.vmsn 虚拟机快照数据文件 .vswp vmname.vswp 虚拟机交换文件 .vmss vmname.vmss 虚拟机挂起文件 .log vmware.log 当前虚拟机日志文件 -#.log vmware-#.log（其中 # 表示从 1 开始的编号） 旧的虚拟机日志条目 15、如何更改vSphere Center的生成日志 解决方法： 修改“vpxd.cfg”文件，然后添加如下内容： D:VMwareLogs 调整日志文件的大小： 10485760 10 保存之后，重启vCenter Server之后，即可生效 16、windows迁移必须在迁移机上开启的服务 解决方法： 需要注意5个服务不能被禁用 1）windows installer 2）volume shadow 3）TCP/IP netBIOS 4）server 5）workstation 如果 Converter Standalone 连接远程 Windows XP 计算机失败，并发出 bad username/password的错误消息， 请确保 Windows 防火墙没有阻止文件和打印机共享。步骤 1 选择开始 &gt; 设置 &gt; 控制面板 &gt; 管理工具 &gt; 本地安全策略。 2 在左侧的安全设置列表中，选择本地策略 &gt; 安全选项。 VMware vCenter Converter Standalone 用户指南 3 在右侧的策略列表中，选择网络访问：本地帐户的共享和安全模式。 4 确保选中经典 – 本地用户以自己的身份验证。 Windows Server 2008（确保启用了 Computer Browser Windows Service） Windows XP(需要打开简单文件共享，启用文件和打印机共享) 17、Linux****迁移注意事项 1）关闭防火墙（service etcinit.diptables stop） 2）SSH 必须打开(sshd start) 3）迁移时需要在help address时为虚拟机设置一个IP地址 redflag 迁移之后没有图形化界面，通过Xconfigurator来重新配置。 redhat 迁移之后没有图形化界面，通过system-config-display来重新配置。 4）迁移后的系统不带IP，需要手动设置 5）数据库或域需要关闭 6）建议冷迁 18、ESXi****不能解析主机名 解决方法： 1） Login to ESXi host 2） vi /etc/hosts 3） Key in every ESXi host in Cluster as the following format IP Address ESXi hostname 192.168.10.10 esx01 192.168.10.11 esx02 … … 192.168.10.9 vCenter01 4） Repeat all the above editing in all ESXi hosts 5）Login in to vCenter 6）Edit /Windows/System32/drive/etc/hosts 19、SCO****迁移后添加网卡不能使用 解决方法： 迁移完成之后，通过netconfig来把原来的网卡删除掉，(如果进入的是图形界面，选tool-unix进入命令窗口）不要把上面的HW SCO TCP/IP Loopback driver 这个网卡删掉。 删除下面的那个网卡，删除完成之后，后提示你重新配置内核，然后重新启动。选择sco虚拟机—编译–添加网卡。重启之后，通过netconfig来添加网卡，添加的是AMD PCNet-PCI Adapter Compatiable……的网卡，然后配置IP。 注意配置IP的时候那个broadcast address不要改，这个是广播地址。网关不需要配置。 20、Linux下安装VMware-tools出现“/etc/vmware-tools/locations”****错误 故障内容: A previous installation of VMware software has been detected. The previous installation was made by the tar installer (version 3). Keeping the tar3 installer database format. Error: Unable to find the binary installation directory (answer BINDIR) in the installer database file “/etc/vmware-tools/locations”. 解决方法： 1、删除etc/vmware-tools目录rm -rf vmware-tools \\2. 删除/tmp/vm* rm -rf vm（注意不要把 VMwa的也删除） 3、然后用tar –zxvf解压 21、所有的虚拟机开启或VMotion出现“文件被锁定，无法访问” 故障内容：环境的所有VM运行出现异常缓慢，关机后的虚拟机开机或VMotion出现“文件被锁定，无法访问” 解决方法:检查日志，特别是存储上LUN的占用情况，如果有存储使用空间接近预警状态，请登陆存储查看，一般这种情况，是存储空间已经没有空余导致，由于vSpherer4的BUG,有时候在没有报警的情况下，存储空间就已经满了情况。请增加存储或移除部分虚拟机。 22、Windows****系统的虚拟机无法进入安全模式 解决方法：选中虚拟机右键“编辑设置”—“选项”–—“引导选项”，在“启动引导延迟”填上“1000”（1秒=1000毫秒，数字可以随便填，稍大一点即可）。然后启动按F8即可进入安全模式。 本文出自 “今夜灿烂” 博客，请务必保留此出处http://saturn.blog.51cto.com/184463/667895 23、vSpherer4.1中32位win2003****会不定时的关机，关机后无法再次登录 故障现象：客户的X86 Windows2003VM系统在使用中会不定时的关机。关机时间不确定，几个小时到几天，关机瞬间就像物理机断电一样，关机后的VM能再次开启，但只要输入账号和密码就立即关机，连安全模式也一样状况。其他X64VM系统没有任何问题。 解决方法：通过两个月的煎熬，排除了网络病毒、物理硬件和系统版本的原因，通过不断的分析ESXi和主机日志，发现有类似如下日志 Sep 07 01:45:03.709: mks| SOCKET 10 (91) recv error 104: Connection reset by peer Sep 07 01:45:03.709: mks| SOCKET 10 (91) destroying VNC backend on socket error: 1 Sep 07 03:26:42.676: vmx| Vix: [10666095 mainDispatch.c:907]: VMAutomation_PowerOff: Powering off. （VM Powering off） 通过400长期的周旋，发现这是7月底发现的BUG,通过在ESXi主机下输入命令： /etc/init.d/sfcbd-watchdog stop chkconfig sfcbd-watchdog off chkconfig sfcbd off 问题解决，但VC上插件和监控状态失效，去官网（http://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;docType=kc&amp;docTypeID=DT_KB_1_1&amp;externalId=2000609）下载最新补丁，安装，一切OK。 24、VM（windows2003****）全屏最大化后，鼠标移动缓慢或错位 解决方法： 1、查看是否安装VMware-tools 2、查看系统内硬件加速是否开启（完全） 3、将虚拟机分辨率调整为：800×600 4、到控制台中打开，上面菜单栏中à视图à自动匹配窗口勾去掉5、查看虚拟机中的显卡驱动是否为：VMware SVGA II 一般情况下，这5点中，满足1、2、3基本可以解决问题，如果全部满足还不行那你只能阿弥陀佛了。当然前提是你已经排除VM OS本身的问题如CPU或内存占用比较大，存储读写延时等等。（注：附件中有图片） 24、用VDR备份无法创建静默快照，因为创建快照操作超过了拖延已冻结虚拟机中 I/O的时限。 解决方法：停止服务VMware Tools Services,打开Vmware Tools安装程序，选择Modify。不要安装Volume Shadow Copy Services Support，完成后重启VM. 25、如何从本地上传下载文件到ESXi主机 解决方法：1、可以通过ESXi的命令SCP上传和下载，在没有三方工具的情况下这个命令需要需要通过另外一台Linux中转才能把需要的文件上传和下载要需要的文件下。 2、由于Client登陆VC后，可以在上面看到共享的存储空间和本地硬盘，这说明ESXi主机内一定有一个文件同样也可以看到这些空间。经过分析发现/vmfs/volumes/目录就是存储和本地硬盘的存放点。可以通过这个目录上传和下载ESXi主机中的文件。 26、在 vCenter Server 升级到 5.0 版本后，ESX 4.0 Update 2 主机可能崩溃 解决方法：发生崩溃时，同时在紫色屏幕上显示以下消息：NOT_IMPLEMENTED bora/vmkernel/filesystems/visorfs/visorfsObj.c:3391。 解决办法：升级到 vCenter Server 5.0 之前，将由 vCenter Server 管理的所有 ESX 4.0 Update 2主机升级到 ESX 4.0 Update 3。 27、HA配置到90%时失败，提示：Internal AAM Error-agent could not start 故障状态： 1、第一台主机加入到Cluster没问题，但是第二台主机加入到cluster时，走到90%出错，提示如下错误：Internal AAM Errors-agent could not start 复制代码 2、在aam_config_util_addnode.log文件里有类似如下错误信息： 01.01/23/10 16:20:49 [myexit ] Failure location: 02.01/23/10 16:20:49 [myexit ] function main::myexit called from line 2199 03.01/23/10 16:20:49 [myexit ] function main::start_agent called from line 1168 04.01/23/10 16:20:49 [myexit ] function main::add_aam_node called from line 171 05.01/23/10 16:20:49 [myexit ] VMwareresult=failure 故障分析： 这种故障一般和UDP 8043端口无法访问有一定关系； 解决方案： 确保UDP 8043端口畅通无阻，比如： 执行如下命令： tcpdump -i vswif0 -s 900 -n udp port 8043 -w ${主机名}.pcap 28、查阅和重装VirtualCenter Server agents(vpxa)服务 故障状态： ·配置VMware High Availability (HA) 失败； ·重新配置 VMware HA时，提示如下错误： Could not Enable aam firewall ruleset :vim.fault.HostConfigFault ·无法将ESX添加到VirtualCenter； ·尝试重新将ESX添加到VirtualCenter时，提示如下错误： unable to access the specified host, either it doesn’t exist, the server software is not responding, or there is a network problem ·在hostd.log文件中有如下内容： [2010-05-24 10:45:51.463 ‘Vmomi’ 15752112 info] Throw vim.fault.AlreadyExists [2008-05-26 10:45:51.463 ‘Vmomi’ 15752112 info] Result: (vim.fault.AlreadyExists) { name = “vpxuser” msg = “” } 解决方案; 备注：当看到如下错误时，请在ESX主机上重装vpxa： unable to access the specified host, either it doesn’t exist, the server software is not responding, or there is a network problem. 查看安装在ESX/ESXi服务器上的VirtualCenter agent(vpxa)版本号的方法如下： 1.首先确定VirtualCenter的版本号：点击Help按钮，点击About可查阅； 命令查看VMware-vpxa的命令： rpm -V VMware-vpxa 29、使用IBM服务器可能导致ESXi/ESX 4.1服务器HBA卡和PCI设备停止响应 故障状态： 当使用IBM x3650 M3或BladeCenter HS22V服务器时，可能会在ESXi/ESX 4.1上遇到下面的问题： 1、HBA卡停止响应； 2、某些PCI设备无响应； 3、可以在ALT+F12界面和日志信息里看到这样的信息： vmkernel: 6:01:34:46.970 cpu0:4120)ALERT: APIC: 1823: APICID 0x00000000 – ESR = 0x40 4、HBA卡停止响应，例如： vmkernel: 6:01:42:36.189 cpu15:4274)&lt;6&gt;qla2xxx0000:1a:00.0: qla2x00_abort_isp: **** FAILED **** vmkernel: 6:01:47:36.383cpu14:4274)&lt;4&gt;qla2xxx 0000:1a:00.0: Failed mailbox send register test 5、HBA卡可能进入离线状态，例如： vmkernel: 6:01:47:36.383 cpu14:4274)&lt;4&gt;qla2xxx 0000:1a:00.0: ISP error recovery failed – board disabled 故障分析： 具体问题还不太清楚，期待VMware官方能够给出解释并放出相关补丁； 解决方案： 在ESXi/ESX 4.1里面雀圣启用了中断重映射代码，而这个代码和部分IBM服务器不兼容，可以通过禁止掉这个代码缺省启动的方式来临时解决这个问题： 1、进入到命令行界面，执行如下命令： #esxcfg-advcfg -k TRUE ioDisableIR #init 6 2、重启后检查这个选项是否依然缺省启动： #esxcfg-info -c iovDisableIR=TRUE 备注：这就表示缺省没有启动； 也可以利用vSphere Client登录到服务器的GUI进行修改 30、虚拟机无法关闭停止在95%左右的解决办法 一次做虚拟机回收工作，由于目标虚拟机当时杀毒软件正在运行，CPU占用很高，本来想登陆关闭虚拟机，但是远程连接根本没反映，打开VC带的控制台，鼠标点击进去，操作也是在是慢，总归到底，最后，直接将虚拟机电源关闭。之后，就看着任务开始执行，但进度条走到95%的时候，咋都不动了。 解决思路： 这个问题，属于一个“沟通”问题，应该从两方面入手： 1、一个是vCenter端是否已经将此命令顺利传送到ESX； 2、然后是，ESXi/ESX端是否顺利接到命令，以及是否执行了此命令。 解决过程： 1、SSH连接ESX； 2、vmware-cmd getstate 确定虚拟机状态； 为完全路径（空格等前别忘了加上转义符 /）；vmware-cmd -l命令可查看虚拟机路 3、官方文档说若为On，可继续执行其他命令来结束虚拟机； 但是我走到这里，显示的为Off；这就说明，ESX已经将虚拟机关闭了，那这问题就是一个沟通问题 4、登陆VC，我想先从VC端将此问题虚拟机所在的主机断开连接，之后再重新连接，这样就会进行一次新的对话，但是，由于前一个未关闭虚拟机的任务未执行完毕，之后的任务好像都成队列似的在等待，没有反应。 5、任务无法执行，重启相关VC和ESX服务 VC：在Vitual Center的WIN机器上的，在服务管理器重启VC服务。 ESX：在SSH登陆后对两个服务器执行重启。（注：虚拟机服务会短暂中断） 命令如下： service mgmt-vmware restart service vmware-vpxa restart 6、在这沟通中的三个服务都已经重启完毕，此时再执行步骤2时，发现返回的结果为On–那台虚拟机正在运行，发现这个，那么按照官方的文档，后续的几个命令就可以有用武之地了。 7、kill -9 xxxx ps -auxwww |grep -i .vmx 可以看到虚拟机的PID 8、执行步骤2，现在已为Off 9、登陆VC查看，刷新下，如果状态还未改变，再重启下VC服务器，即可。 31、为主机应用Host Profiles提示compliance错误故障状态： 为主机应用Host Profiles失败，提示如下错误： 01.Specification state absent from host: device ‘’ state needs to be set to ‘on’ 02.Host state doesn’t match specification: device ‘’ needs to be reset 03.Specification state absent from host: device ‘’ Path Selection Policy needs to be set to ‘VMW_PSP_FIXED’ 04.Host state doesn’t match specification: device ‘’ Path Selection Policy needs to be set to default for claiming SATP 故障分析： 这是由于PSA组件导致的； 解决方案： 1、右击Host Profiles后点击Enable/Disable Profiles配置选项； 2、展开“Storage Configuration”选项，展开“Pluggable Storage Architecture”这个uxanxiang； 3、去掉“PSA Device Configuration”； 4、展开“Native Muti-Pathing(NMP)”这个选项后，接着展开“PSP and SATP configuration for NMP devi”选项； 5、去掉“PSP configuration for”这个选项后点击OK即可。 33、分析、解决IOPS导致的虚拟机/存储性能下降和虚拟机磁盘延时较大的问题故障状态： 1、虚拟机性能较低； 2、在执行备份时磁盘延时很厉害； 3、虚拟磁盘vmdk延时较大； 故障分析： 这种问题基本都是由于虚拟机没有足够的IO Per Second（IOPS），或者IOPS低于30； 解决方案： 在解决问题前，首先要解决以下两个问题： 问题1：什么是IOPS？ IOPS全称为Input/Output Per Second，它是衡量一个磁盘（虚拟磁盘和物理磁盘）、存储的基本也是十分重要的标准。不同的磁盘、存储有着不同的IOPS。IOPS的高低直接会影响着系统的性能。当前，VMware虚拟化环境中最大的瓶颈也就在于这个IOPS。针对数据密集型业务的数据库业务和流媒体业务，由于它们的IOPS很大，所以在虚拟化环境中部署它们一定要充分考量它们的负载，也就是IOPS大小，结合实际的存储性能来查看是否符合业务标准。 问题2：如何计算IOPS？ 如何计算每台虚拟机的IOPS？ 要想计算每个虚拟机的总的IOPS数量，首先就要确认磁盘类型以及它们的IOPS是多少。处于RAID阵列里面的每个盘的IO有利于增长整体存储的可用IOPS。而位于这个存储上面的单台虚拟机的IOPS，则可以通过将这个存储的总IOPS除掉虚拟机数量即可基本得到单台虚拟机的IOPS。 现实案例： 假定有6颗10000RPM的磁盘，那么它们的总的可用IOPS大约为150×6=900。如果LUN上面运行的虚拟机数量为50个，则单台虚拟机的IOPS为900/50=18 IOPS。如果以这个为标准，则意味着虚拟机的性能相对底下。如果想要满足虚拟机的基本IOPS需求，那么应该为900/30=30，也就是说同一个Volume里IOPS为30（最低要求）虚拟机需要数量控制在30台以下。 备注：备份存储会消耗更多的IOPS，同时也会给Volume带来更多额外的符合。如果是这样，则需要用额外手段解决备份时的额外资源消耗（可以通过I/O meter软件来测试IOPS） 34、丢失或锁定文档导致虚拟机无法Power On故障状态： 1、虚拟机无法开启； 2、尝试开启虚拟机时，看到类似如下错误信息： Unable to open Swap File； Unable to access a file since it is locked； Unable to access Virtual machine configuration； 3、在/var/log/vmkernel文件里可以看到类似如下信息： WARNING: World: VM xxxx: xxx: Failed to open swap file ock was not free WARNING: World: VM xxxx: xxx: Failed to initialize swap file 4、当尝试开启虚拟机的console控制台时，可能会收到如下错误信息： Error connecting to .vmx because the VMX is not started 5、在开启虚拟机时，卡在95%位置无响应； 6、从模板部署一台新的VM之后无法开启虚拟机； 7、虚拟机在vCenter Server和ESXi/ESX主机之间报告控制台电源状态冲突； 故障分析： 导致这个问题的因素可能很多，但是众多问题中，都穿插或包含着文件损坏或文件被锁定等问题的可能。虚拟机常用的文件包括： *.vswp *-flat.vmdk *-delta.vmdk *.vmx *.log 解决方案： 首先需要确认哪些文件处于锁定状态： 1、利用vSphere Client登录ESXi/ESX主机、vCenter Server主机； 2、在Datastore里找到想要开启但是无法开启的虚拟机所在位置； 3、尝试开启虚拟机，如果无法开启且console显示错误，先查阅vmware.log日志文件的相关信息来确认问题； 4、利用SSH或COS选用root权限登录到ESXi/ESX主机之后执行下面的命令查看虚拟机的完整路径： #vmware-cmd -l 系统将输出类似如下信息来显示注册到ESXi/ESX主机的虚拟机： /vmfs/volumes//&lt;虚拟机目录&gt;/&lt;虚拟机名&gt;.vmx 5、执行下列命令切入到这个虚拟机所在的目录： #cd /vmfs/voluems//&lt;虚拟机目录&gt; 6、然后查阅vmware.log日志，在文件的尾部查看什么原因导致这个问题后再针对性的分析。 准确定位并删除掉锁定文件 由于虚拟机可以在主机之间移动，如果虚拟机注册到的主机保持对文件的锁定状态，那么，这个锁定文件可以有效保障ESXi/ESX主机对虚拟机文件的控制权和有效保护虚拟系统。主机由Service Console接口的MAC来确定。lock由VMkernel或Service Console负责维护； 备注：ESXi服务器没有Service Console所以，lock由VMkernel单独负责维护； 首先要确定VMkernel可能锁定的文件： 1、执行下面的命令来报告锁定目录所在的MAC地址： #vmkfstools -D /vmfs/volumes//&lt;虚拟机目录&gt;/&lt;锁定状态文件&gt; 2、由于负责锁定.vmdk文件的主机会将MAC地址写入到vmkernel日志里面，那么可以用下面的命令查阅： #tail /var/log/vmkernel 35、Storage vMotion失败：looking for lines staring with “CBTMotion”故障状态： 1、执行Storage vMotion失败； 2、系统提示如下错误信息： 01.A general system error occurred: Storage VMotion failed to copy one or more of the VM’s disks. Please consult the VM’s log for more details, looking for lines starting with “CBTMotion-“. 复制代码3、/var/log/vmware/hostd.log文件里有类似如下信息： 01.Failed with error 340983807: Storage VMotion failed to copy one or more of the VM’s disks. Please consult the VM’s log for more details, looking for lines starting with “CBTMotion”. 复制代码故障分析 可能由于虚拟机的硬件版本号过老导致； 解决方案： 关掉虚拟机后右击uxniji选择Upgrade Virtual Machine Hardware即可。 36、添加LUN时提示HostDatastoreSystem.QueryVmfsDatastoreCreateOptions故障状态： 系统能够扫描到Devices LUN，但是在添加过程中却提示如下错误信息：HostDatastoreSystem.QueryVmfsDatastoreCreateOptions ，如图所示： 故障分析： 这样的问题一般都是由于LUN的尺寸过大导致，一般来说，VMware ESXi/ESX Server标准支持最大的LUN尺寸为2TB-512Byte，但是由于国内很多技术人员对这个-512Byte并不太在意，所以习惯型的讲成2TB，这就导致很多用户在使用时，直接分配了2TB的空间，这就可能导致了上述问题； 解决方案： 针对这样的问题，建议如下： 1、如果已经分好了2TB的LUN，建议调整为1.88TB左右后再尝试添加； 2、新LUN规划用户则请严格参照官方文档的参数设计，建议是1.88TB左右为一个LUN生成Datastore 37、vCenter Converter推送Agent出错：Converter Agent installer/uninstaller Failed故障状态： 1、利用vCenter Converter推送Agent到Windows Server 2003服务器上时，失败； 2、系统提示类是如下错误信息： 01.Converter Agent installer/uninstaller failed on ‘xxxxxxxxx’. 3、VMware vCenter Converter的日志文件converter-server.log里面有类似如下错误提示： 01.[#6] [2011-01-21 10:50:55.976 04080 info ‘App’] [agentManager,83] [AgentManager] Install Agent on 192.168.10.10 02.[#6] [2011-01-21 10:51:16.976 04080 error ‘App’] [agentManager,95] [AgentManager] Install Agent failed: converter.fault.AgentDeploymentFault 03.[#7] [2011-01-21 11:18:37.289 03976 info ‘App’] Reusing existing VIM connection to 192.168.30.150 04.[#7] [2011-01-21 11:18:37.476 03976 error ‘App’] Found dangling SSL error: [0] error:00000001:lib(0):func(0):reason(1) 05.[#7] [2011-01-21 11:19:00.945 02756 info ‘App’] [agentManager,83] [AgentManager] Install Agent on 192.168.10.10 06.[#7] [2011-01-21 11:19:21.961 02756 error ‘App’] [agentManager,95] [AgentManager] Install Agent failed: converter.fault.AgentDeploymentFault 7.[#7] [2011-01-21 11:19:32.445 03976 info ‘App’] [diagnosticManager,357] Generating Converter.Server log bundle. 故障分析： 以下几种情况可能导致这样的问题： 1、445端口没能打开； 2、曾经手动安装过Agent后卸载； 3、Windows服务管理其中的server服务没有启动导致的IPC$连接失败； 4、防火墙阻绝； 解决方案 1、确认445端口或NetBIOS协议能正常使用； 2、建议在Converter时关闭防火墙； 3、如果依然有问题，尝试用Converter Standardalone版本迁移或采用ConverterCD进行冷克隆。 38、解决在vSphere 5.0里开启HA时，提示：Datastore Heartbeating不足的问题故障状态： 为ESXi 5.0+vCenter 5.0配置HA时，提示如下信息： 故障分析： 这是由于vSphere 5.0里的HA部分已经重写，并且新增了Datastore Heartbeating用于网络Partition心跳检测支持； 解决方案： 有2个选择，一个是加多存储用于心跳检测，这也是正确的选择，就不多讲，另一个就是忽略掉这个问题，方法如下： 1、vSphere Client登录到vCenter Server 5.0后，右击HA Cluster，点击Edit，然后找到高级选项设定： 2、再如上图所示的内容中，添加下参数： das.ignoreinsufficienthbdatastore 备注：缺省情况下，这个参数的值是false的。 39、通过vSphere Client登陆ESXi主机提示“正在更新”的问题 故障状态： 通过vSphere Client登陆VCenter Server4.1正常，登陆ESXi主机提示如下图： 故障分析： 需要通过‘vSphereclient.vmware.com’来更新Client说明客户端存在问题，由于登陆VCenter Server4.1不存在任何问题，所以基本确定版本的问题。查看ESXi版本和vSphere Client，发现Client的版本低于ESXi版本。 解决方案： 由于Client所在网络无法上Internet,所以无法更新Client客户端，可以通过安装高版本的Client来解决此问题。 40、红旗32位Linux进入系统时提示”udevu”无法继续进入系统的问题故障状态：进入系统后，出现下图的界面，之后无法向下运行，必须按Ctrl+C才能继续向下运行 故障分析：由于系统安装时候是完整的，光盘镜像包是完整的，安装的时候不存在任何问题。考虑到物理机上不存在这种问题，怀疑虚拟机虚拟驱动的问题，安装新的VMware-tools问题依旧。 解决方案：考虑到红旗Linux比较新，去官方下载11月份最新的VMware-tools，问题解决 (下载地址：http://packages.vmware.com/tools/esx) 50、虚拟机文件被锁,无法正常 power on故障状态：启动虚拟机时95%,停顿并且进程中断,提示：ubable to access files since it is locked。祸根：HA解决方法：****1.首先将cluster中的HA功能关闭。如果该功能不关闭，容易造成死锁,，VM不断跳动,，不断再不同的ESX内循环被锁，徒劳而无功。2.磁盘文件被锁，要解决，必须要知道到底是哪台ESX把他给锁住了，这是关键。方法：看/var/log/vmkernel但是，在做这些前, 再准备些别的工作。3.在VC中，把被锁的VM从Inventory中remove掉。原因很简单，这是一个 unregister的过程。4.根据/var/log/vmkernel，搜索owner，可以找到类似以下的语句:Oct 19 04:23:33 esx-hostname vmkernel: 3:06:29:47.992 cpu6:1656)FS3: 1975: Checking if lockholders are live for lock [type 10c00001 offset 52008960 v 380, hb offset 3554304Oct 19 04:23:33 esx-hostname vmkernel: gen 17, mode 1, owner48f5f637-462688bc-fd28-0e1a6434b6f8 mtime 38112]OK，owner后面的48f5f637-462688bc-fd28-0e1a6434b6f8就是你的target了。 因为他就是锁住VM 的宿主.。5.根据以下命令,，找出到底哪台ESX的UUID是 48f5f637-462688bc-fd28-0e1a6434b6f8[root@esxhostname root]# esxcfg-info |grep -i ‘system uuid’6.找到目标主机后，当然是杀死他锁住VM的进程。之所以会被锁，原因就是HA 把VM从别的HOST迁移过来，但是又没有unregister和register的过程，所以在第3步的时候，你查看VM的Summary的时候，host ip还是属于出问题的 host。 但是VM又被新的host霸王硬上功的power on，注册都没注册, 又怎么启动呢。找到 PID 用下面的命令：ps -efwww|grep virtualmachine.vmx找到 PID 后, kill -9 PID7.这时候，还要确定一件事情， .vswp文件的事情。这个是给台客处理问题时吸取的经验。就因为忽略了这个，所以在杀掉迚程后，重新注册VM，还说没有 SWAP文件，启动还是失败。在 VM 启动时会自动生成SWAP，没有SWAP文件，其实就是因为 SWAP 存在了, 因为重名而导致无法正常生成。进入到/vmfs/volumes/lunid/vm_path/下，vmkfs -d virtual_machine.vswp或者进入Datastore Browser，在里面把SWAP文件删除也可。8.完全之策，你还可以进入到VM的SETTINGS–OPTIONS–SWAPFILE LOCATION， 对该保存的位置做下设置。9.重新注册VM。进入Datastore Browser，找到VM.vmx，add to inventory。10.启动 VM. Good Luck。 51、忽视掉ESXi/vCenter Server提示SSH事件的方法 1. vSphere Client连接到VC或者ESXi服务器； 2. 在Home -&gt; Inventory -&gt; Hosts and Clusters里展开选中你的ESX服务器； 3. 右边选择Configuration，然后点击Software栏目里的Advanced Settings； 4. 在Advanced Settings里选择左边列表中的UserVars； 5. 选中左边列表中的UserVars后，在右边拖到最下面，将UserVars.SuppressShellWarning的值改为1即可，不需要重启。 52、尝试迁移一台带USB设备的VM失败故障状态： 在执行虚拟机迁移向导时，如果系统检测到不兼容的USB设备存在，则系统会提示如下错误信息： Currently connecteddevice ‘USB 1’ uses backing ‘path:1/7/1’,which is not accessible. 故障分析： 这种问题通常发生在为主机开启了VMDirectPath I/O支持下的USB Passthrough Devices功能，然后为特定的VMs分配了USB设备，比如：加密狗； 解决方案： 1、确认USB设备能够被虚拟机识别和支持，并确保在添加USB设备到VMs时，勾选了with vMotion选项； 2、在执行vMotion动作之前，重新尝试将USB设备添加到VMs； 3、确认ESXi主机没被重启过，因为，ESXi主机重启之后，原本支持的vMotion WithvMotion功能将会失效。 53、Convert Linux系统的Troublshooting过程 (1)、确认源转换Linux机器的OS在官方的支持列表中； (2)、拥有root权限； (3)、确认DNS的设定有没有问题，注意：应该同时在Linux和Windows都加上； (4)、确认源Linux能够ping同ESX或vCenter的IP。如果在2%时失败，最大的可能就是权限问题或防火墙阻隔问题； (5)、确认Linux允许SSH登陆进去。这个，可以帮助我们在converting的时候登录到Linux系统； (6)、确认是给helper virtual machine设定的静待IP，而不是DHCP获取的（如果网内没有DHCP服务器）； (7)、确认源和目标都在同一子网。如果通过路由链接的不同子网可能会出错； (8)、注意，converter不支持做了软阵列的Linux系统。可以用冷克隆光盘来做，它会把软阵列的设定为/dev/md0。 (9)、VMware Converter Standalone的日志目录：C:Documents and SettingsAll UsersApplication DataVMwareVMware vCenter Converter Standalone，用于排错时用。 54、vCenter Service Status页面故障：Unable to retrieve health status 故障状态： vCenter Server Status页面提示如下错误信息： Unable to retrieve health status for vCenter inventory service Unable to retrieve health status for VMware vSphere Profile-Driven storage service 执行vCenter Server的搜索动作时，提示如下错误提示： Unable to connect to webservices to perform query. Verify that the “VMware VirtualCenter Management WebServices” service running onhttps://:10443 故障分析： 这个问题一般都由于当vCenter Server服务发生了变更或全新安装了一台vCenter Server，但是数据库依然是原来的数据库导致； 解决方案： 替换掉vws.jar、jointool.jar和ds.jar文件即可，步骤如下： 下载本文附件中的vws.zip文件然后解压缩vws.jar、jointool.jar和ds.jar文件； 停止掉VirtualCenter Server服务以及VirtualCenter Management Webservices服务；拷贝vws.jar和jointool.jar到C:ProgramFilesVMwareInfrastructuretomcatwebappsWEB-INFlib覆盖掉原来的文件；拷贝ds.jar文件到C:Program FilesVMwareInfrastructureInventory Servicelib覆盖掉原来的文件；重新启动相关服务或vCenter Server服务器即可。 55、VMRC 控制台的连接已断开…正在尝试重新连接 故障状态： 用vSphere Client连接到ESXi 5.0的主机，启动其中的虚拟机后，无法连接控制台，打开控制台之后，窗口上方提示一行“VMRC 控制台的连接已断开…正在尝试重新连接。” 故障分析： 从情况看，类似于Windows系统的DEP策略处于开启状态导致的问题一样。但这个情况是所有虚拟机都提示这个错误，排错DEP的问题，用本地vSphere Client登录一个VC平台，问题仍旧一样。为了排除问题，换了一台笔记本登录VC，突然发现问题不见了。原来是本地的vSphere Client出了问题，再三思索，发现出现问题前我对本地WIN7用360安全卫士升级了补丁，是否是补丁破坏了vSphere Client某个文件呢 解决方案： 重现安装vSphere Client，问题解决。 56、端口 80 的 vCenter Server 和 IIS 之间的冲突 故障状态： vCenter Server 和 Microsoft Internet Information Service (IIS) 都将端口 80 用作直接 HTTP 连接的默认端口。该冲突会导致安装 vSphere Authentication Proxy 后 vCenter Server 无法重新启动。 在 vSphere Authentication Proxy 安装完成后， vCenter Server 无法重新启动。 故障分析： 如果安装 vSphere Authentication Proxy 时未安装 IIS ，则安装程序会提示您安装 IIS 。因为 IIS 使用端口 80 ，这是用于 vCenter Server 直接 HTTP 连接的默认端口， 所以 vCenter Server 在 vSphere Authentication Proxy。安装完成后无法重新启动。请参见第 32 页，“ vCenter Server 所需的端口” 。 解决方案：要为端口 80 解决 IIS 和 vCenter Server 之间的冲突，请执行以下操作之一。 如果在安装 vCenter Server 之前已安装 IIS 将 vCenter Server 直接 HTTP 连接的端口由 80 更改为其他值。 如果在安装 IIS 之前已安装 vCenterServer 重新启动 vCenter Server 之前， 将 IIS 默认网站的绑定端口由 80 更改为其他。 57、在 UEFI 模式下安装 ESXi 后主机无法引导 故障状态： 在 UEFI 模式下， 在主机上安装 ESXi 后重新引导时， 重新引导可能失败。 出现此问题的同时， 还显示一条类似于以下内容的错误消息： 发生异常网络错误。无可用的引导设备 (Unexpected network error. No boot device available)。 故障分析： 主机系统无法识别作为引导磁盘在其上安装 ESXi 的磁盘。 解决方案： 1 屏幕上显示错误消息时，按 F11 显示引导选项。 2 选择一个类似于添加引导选项的选项。该选项的文字可能有所不同，具体取决于您的系统。 3 在安装 ESXi 的磁盘上选择文件 EFIBOOTBOOTx64.EFI 。 4 更改引导顺序，以便主机从添加的选项引导。 58、将 Microsoft SQL 数据库设置为不受支持的兼容模式会导致 vCenter Server 安装或升级失败 当数据库设置为不支持的版本的兼容性模式时，使用 Microsoft SQL 数据库的 vCenter Server 安装会失败。 故障状态:将显示以下错误消息： 输入的数据库用户没有使用选定数据库安装和配置 vCenter Server 所需的必要权限。 请更正以下错误 : %s 故障分析： 数据库版本必须是 vCenter Server 支持的版本。 对于 SQL ， 即使数据库是受支持的版本， 但如果将其设置为以不支持的版本的兼容性模式运行， 仍会发生此错误。 例如， 如果将 SQL 2008 设置为以 SQL 2000 兼容性模式运行，就会发生此错误。 解决方案：u 请确保 vCenter Server 数据库是受支持的版本， 并且没有设置为以不支持的版本的兼容性模式运行。 59、误删运行中的虚拟机，通过xx-flat.vmdk恢复方法 **故障状态:**误删了运行中的虚拟机，进入目录查看，只剩下xx-flat.vmdk文件，从文件的类型看，只是File格式，不是Virtual Disk格式，新建虚拟，选择添加已存在磁盘，提示不存在 解决方案： \\1. 新建一虚拟机，不要创建硬盘 \\2. 用ssh的方式登录host，查找xx-flat.vmdk文件所在位置及目录， \\3. 在上面这个文件相同目录下创建新xxx.vmdk文件，大小要和xx-flat.vmdk文件一样大， 用ls -la查看xx-flat.vmdk文件大小， 用vmkfstools -c 文件大小 -a lsilogic xxx.vmdk 来创建新磁盘文件 \\4. 将这个磁盘文件添加到新建的虚拟机中； \\5. 用原文件xx-flat.vmdk覆盖新建的xxx-flat.vmdk（注意一定是-flat.vmdk)，使用mv命令 \\6. 完成后开启虚拟机就可以了 60、在view桌面中，Win7下安装出现软件出现“系统管理员设置了系统策略，禁止进行此安装”的提示解决方案： 1、打开“开始-&gt;控制面板-&gt;管理工具-&gt;本地安全策略”-&gt;点击“软件限制策略”，如果提示“没有定义软件限制策略”，那么就右键“创建软件限制策略”-&gt;创建后，双击右侧“强制”，选择“除本地管理员以外的所有用户”，确定 2、windows开始菜单，运行里面输入gpedit.msc打开组策略, 在“计算机配置”→管理模板→windows组件→windows installer，右边 第一项就是禁用windows installer。把它改成 “未配置”后者“已禁用”就可以了。 3、删除HKEY_CLASSES_ROOTInstallerProducts4080110900063D11C8EF10054038389C注册表项目。（建议使用此法，能解决大多数你出现的情况，在运行栏里输入regedit进入注册表，按照以上路径找到项目删除就可以了） 61、持续较高的 CPU 使用情况的解决方案故障状态: CPU 使用情况中的临时高峰表示 CPU 资源的使用情况最佳。持续较高的 CPU 使用情况可能表示存在问题。 您可以使用 vSphere Client CPU 性能图表监控主机、群集、资源池、虚拟机和 vApp 的 CPU 使用情况。 问题 n 主机 CPU 使用情况一直很高。 CPU 使用情况值较高时会增加主机上虚拟机的就绪时间和处理器列队。 n 虚拟机 CPU 使用情况超过 90% ，且 CPU 就绪值超过 20% 。应用程序性能将受到影响。 原因 主机可能缺少满足要求所需的 CPU 资源。 解决方案： n 验证是否在主机的每台虚拟机上均安装了 VMware Tools 。 n 将主机上或资源池中其他虚拟机的 CPU 使用情况与此虚拟机的 CPU 使用情况值进行比较。 主机的虚拟机 视图上的堆栈条形图显示主机上所有虚拟机的 CPU 使用情况。 n 确定虚拟机就绪时间过长是否由其 CPU 使用情况时间达到 CPU 限制设置所致。 如果出现这种情况， 请增 加虚拟机上的 CPU 限制。 n 增加 CPU 份额以给予虚拟机更多机会运行。 如果主机系统受到 CPU 约束， 则主机上的总就绪时间可能仍 维持在相同级别。如果主机就绪时间没有减少，则为高优先级虚拟机设置 CPU 预留，保证它们收到所需 要的 CPU 周期。 n 增加分配给虚拟机的内存量。此操作会减少所缓存应用程序的磁盘和 / 或网络活动。这可能会降低磁盘 I/O ，并减少主机对虚拟化硬件的需求。具有较少资源分配的虚拟机通常可累积更多的 CPU 就绪时间。 n 将虚拟机上的虚拟 CPU 数量减少到执行工作负载所需要的数量。例如，四路虚拟机上的单线程应用程序 只能从单个 vCPU 中受益。 而管理程序还需维护三个空闲 vCPU ， 占用本可用来处理其他工作的 CPU 周期。 n 如果主机不在 DRS 群集中，则将它添加到一个群集中。如果主机在 DRS 群集中，则增加主机数，并将一 个或多个虚拟机迁移到新主机上。 n 如有必要，请在主机上升级物理 CPU 或内核。 n 使用最新版本的管理程序软件并启用 CPU 节省功能（例如 TCP 分段卸载、较大内存页面和巨型帧）。","categories":[],"tags":[{"name":"esxi","slug":"esxi","permalink":"http://example.com/tags/esxi/"}]},{"title":"venter挂载iscsi问题","slug":"vcenter挂载iscsi问题","date":"2021-07-30T06:44:15.245Z","updated":"2021-08-31T07:02:57.983Z","comments":true,"path":"2021/07/30/vcenter挂载iscsi问题/","link":"","permalink":"http://example.com/2021/07/30/vcenter%E6%8C%82%E8%BD%BDiscsi%E9%97%AE%E9%A2%98/","excerpt":"","text":"Q：碰到vcenter挂载的ISCSI存储服务挂了以后，ISCSI存储也挂了，但是数据存储服务器起来后，vcenter上扫描存储依然没有起来。 表现如下（灰色状态）： 尝试将链路全部删掉，lun卷依然存在，如下 将万兆网卡替换、刷新适配器、重新扫描存储依然不能解决 ssh登录esxi上准备找找相关服务进程、分析，看看有没有remove或者kill这个存储lun的相关信息。 心里打算重启设备（很头疼，上面都是生产环境，但没有可用资源用于迁移） 最后尝试 发现卸载不掉，报错。想着，整个卷我都删除了怎么还在使用？最后突然灵光一动，应该是使用这个卷的虚拟机没关机！！ 最后把相关的虚拟机关机后，正常可以卸载 然后添加链路、动态发现等ISCSI配置，正常！ 重新扫描存储、刷新一下就恢复了 虚拟机系统是本地存储盘，但数据存放用的是ISCSI的存储卷 PS：像这种问题会有各种各样的，前面主要是都没有报错，所以无法正确去判断，当然对于vcenter6.7的操作还是少了。多观察、多累计经验、多记录、多操作。","categories":[],"tags":[{"name":"VMware","slug":"VMware","permalink":"http://example.com/tags/VMware/"}]}],"categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"},{"name":"esxi","slug":"esxi","permalink":"http://example.com/tags/esxi/"},{"name":"VMware","slug":"VMware","permalink":"http://example.com/tags/VMware/"}]}